{% load static %}
{% for video in videos %}
  <div class="video-preview">
    <h4>{{ video.title }}</h4>
    {% if course.thumbnail %}
    <img src="{{ course.thumbnail.url }}" class="w-full h-48 object-cover rounded-xl mb-2" />
{% else %}
    <img src="{% static 'images/default-course-thumbnail.jpg' %}" class="w-full h-48 object-cover rounded-xl mb-2" />
{% endif %}
    <div id="player-{{ video.id }}"></div>
    <select onchange="changeQuality(this.value, '{{ video.id }}')">
      <option value="144">144p</option>
      <option value="240">240p</option>
      <option value="480">480p</option>
      <option value="720" selected>720p</option>
    </select>
  </div>
{% endfor %}

<script>
function loadVideo(videoId) {
    const quality = document.querySelector(`#player-${videoId} select`)?.value || '720';
    const playerDiv = document.getElementById('player-' + videoId);
    playerDiv.innerHTML = `
      <video width="640" height="360" controls autoplay>
        <source src="/stream-video/${videoId}/${quality}/" type="video/mp4">
        Your browser does not support the video tag.
      </video>`;
}

function changeQuality(newQuality, videoId) {
    const playerDiv = document.getElementById('player-' + videoId);
    if (playerDiv.innerHTML.includes('video')) {
        loadVideo(videoId);  // Reload with new quality
    }
}
</script>
